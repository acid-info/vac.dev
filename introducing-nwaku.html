<!DOCTYPE html>
<html class="h-full" lang="en-US">
  <head>
  
  <title>Vac - Introducing nwaku</title>
  

  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Vac</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script async defer src="https://cdn.simpleanalytics.io/hello.js"></script>
  <noscript><img src="https://api.simpleanalytics.io/hello.gif" alt="" /></noscript>

  <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
  <script>
    (function (f, a, t, h, o, m) {
      a[h] =
        a[h] ||
        function () {
          (a[h].q = a[h].q || []).push(arguments);
        };
      (o = f.createElement("script")), (m = f.getElementsByTagName("script")[0]);
      o.async = 1;
      o.src = t;
      o.id = "fathom-script";
      m.parentNode.insertBefore(o, m);
    })(document, window, "//fathom.status.im/tracker.js", "fathom");
    fathom("set", "siteId", "YELIA");
    fathom("trackPageview");
  </script>
  <!-- / Fathom -->

  <!-- Twitter cards -->
  <meta name="twitter:site" content="@vacp2p" />
  <meta name="twitter:creator" content="@hanno" />
  <meta name="twitter:title" content="Introducing nwaku" />

  
  <meta name="twitter:description" content="Introducing nwaku, a Nim-based Waku v2 client, including a summary of recent developments and preview of current and future focus areas." />
   
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://vac.dev/assets/img/vac.png" />
  
  <!-- end of Twitter cards -->

  <link rel="shortcut icon" href="/assets/img/favicon.png" type="image/png" />
  <link rel="preload" href="/fonts/OpenSans-Regular.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/OpenSans-SemiBold.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="preload" href="/fonts/OpenSans-SemiBoldItalic.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="stylesheet" href="/assets/css/style.css" />
</head>

  <body class="h-full flex flex-col font-body">
    <div class="flex-grow container max-w-screen-xl mx-auto px-5 md:px-12 lg:pt-6">
      <header class="sm:sticky sm:top-0 bg-white z-50">
  <div class="container max-w-screen-xl sm:border-b">
    <div class="nav-section flex justify-between items-center py-3 md:py-5 lg:py-10">
      <div class="logo md:pr-8 l:p-0">
        <a href="/"><img src="/assets/img/logo.png" alt="Vac logo" class="w-9 h-11" /></a>
      </div>
      <div class="flex justify-between items-center w-9/12">
        <div class="burger block sm:hidden z-50">
          <button class="burger__button burger__button--open fixed top-2 right-5 w-12 h-12" type="button" aria-label="Mobile menu button">
            <img class="burger__icon" src="/assets/img/burger.svg" alt="Open menu button" />
          </button>
          <button class="burger__button burger__button--close hidden fixed top-2 right-5 w-12 h-12" type="button" aria-label="Close mobile menu button">
            <img class="burger__icon burger__icon--close" src="/assets/img/close.svg" alt="Close menu button" />
          </button>
        </div>

        <nav class="nav max-w-screen-xm md:max-w-screen-sl container">
          <ul class="nav__list hidden sm:flex justify-between container text-xs font-semibold md:pr-8 l:p-0">
             <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#work">Work</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#about">About</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#join">Join Vac</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/research-log">Research log</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/media">Media</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a href="https://rfc.vac.dev/" target="_blank" rel="noopener noreferrer">Specs</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a href="https://forum.vac.dev/" target="_blank" rel="noopener noreferrer">Forum</a>
  
</li>
 
          </ul>
        </nav>

        <ul class="social items-center hidden md:flex">
          <li class="pr-5">
  <a href="https://twitter.com/vacp2p" target="_blank" rel="noopener noreferrer">
    <svg width="25" height="21" viewBox="0 0 25 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M24.8872 3.04499C23.9872 3.43499 23.0572 3.70498 22.0672 3.82499C23.0872 3.22498 23.8672 2.26499 24.2272 1.09499C23.2672 1.66499 22.2172 2.05499 21.1072 2.29499C20.2072 1.33499 18.9172 0.734985 17.5072 0.734985C14.7772 0.734985 12.5872 2.95499 12.5872 5.65499C12.5872 6.04499 12.6172 6.40498 12.7072 6.76498C8.62721 6.58498 5.02721 4.60498 2.59721 1.63499C0.857207 4.75498 2.80721 7.33499 4.09721 8.20499C3.31721 8.20499 2.53721 7.96499 1.87721 7.60499C1.87721 10.035 3.58721 12.045 5.80721 12.495C5.32721 12.645 4.24721 12.735 3.58721 12.585C4.21721 14.535 6.04721 15.975 8.17721 16.005C6.49721 17.325 4.03721 18.375 0.887207 18.045C3.07721 19.455 5.65721 20.265 8.44721 20.265C17.5072 20.265 22.4272 12.765 22.4272 6.28499C22.4272 6.07499 22.4272 5.86499 22.3972 5.65499C23.4172 4.90499 24.2572 4.03499 24.8872 3.04499Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>
<li class="pr-5">
  <a href="https://github.com/vacp2p" target="_blank" rel="noopener noreferrer">
    <svg width="26" height="25" viewBox="0 0 26 25" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M12.8857 0.856567C6.26021 0.856567 0.915339 6.20154 0.950043 12.7951C0.9778 18.0687 4.43935 22.5427 9.21766 24.1227C9.81824 24.2327 10.0353 23.864 10.0336 23.5474C10.0321 23.2635 10.0177 22.5129 10.0065 21.5171C6.67274 22.238 5.95552 19.9163 5.95552 19.9163C5.40376 18.5369 4.61433 18.1698 4.61433 18.1698C3.51994 17.4296 4.69151 17.4444 4.69151 17.4444C5.89646 17.5291 6.53549 18.6751 6.53549 18.6751C7.61609 20.4989 9.35182 19.9727 10.0342 19.6665C10.1382 18.8951 10.4459 18.3689 10.7878 18.0702C8.12222 17.7684 5.31483 16.7443 5.29076 12.1708C5.2839 10.8672 5.74629 9.80152 6.50989 8.96619C6.3838 8.66445 5.96641 7.45009 6.61027 5.80766C6.61027 5.80766 7.61658 5.4866 9.9167 7.03094C10.8723 6.76636 11.8976 6.63408 12.9191 6.62962C13.9376 6.63556 14.9658 6.76636 15.9257 7.03242C18.2081 5.48809 19.2163 5.80914 19.2163 5.80914C19.8789 7.45306 19.4743 8.66594 19.3529 8.96767C20.1268 9.80301 20.5959 10.8687 20.6028 12.1723C20.6269 16.7577 17.8272 17.767 15.1558 18.0628C15.5882 18.4314 15.976 19.1597 15.9819 20.273C15.9903 21.8693 15.9821 23.1565 15.9841 23.5474C15.9858 23.867 16.2038 24.2386 16.8122 24.1212C21.5663 22.5397 24.9778 18.0672 24.95 12.7951C24.9153 6.20154 19.5142 0.856567 12.8857 0.856567Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>
<li>
  <a href="https://discord.gg/PQFdubGt6d" target="_blank" rel="noopener noreferrer">
    <svg width="25" height="21" viewBox="0 0 25 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M22.7861 9.04256C21.8482 5.74455 20.7799 4.04048 20.7627 4.00991C20.7017 3.93459 19.189 2.104 15.5271 0.75L15.0353 2.0764C16.7774 2.72057 18.0116 3.50643 18.6899 4.01419C16.6599 3.40408 14.2431 3.03041 12.1008 3.03041C9.95851 3.03041 7.53775 3.40408 5.50128 4.01419C6.18496 3.50648 7.42744 2.72057 9.17631 2.0764L8.69846 0.75C5.02238 2.104 3.49044 3.93459 3.42863 4.00991C3.41108 4.04048 2.32479 5.74455 1.35221 9.04256C0.414855 12.2208 0.0415214 16.7045 0.027872 16.8843C0.109225 17.0131 1.97891 20.25 7.12077 20.25L8.43406 18.3536C6.97595 17.964 5.58693 17.3357 4.31689 16.4832L5.10228 15.3069C7.15122 16.6822 9.54509 17.4092 12.0251 17.4092C14.5051 17.4092 16.9067 16.6822 18.9701 15.3069L19.7431 16.4832C18.4641 17.3357 17.0684 17.964 15.6062 18.3536L16.8995 20.25C22.0414 20.25 23.9452 17.0131 24.0279 16.8843C24.0161 16.7045 23.69 12.2208 22.7861 9.04256ZM8.79853 12.7392H7.39228L7.40468 10.3841H8.81093L8.79853 12.7392ZM16.7071 12.7392H15.3008L15.3132 10.3841H16.7195L16.7071 12.7392Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>

        </ul>
      </div>

      <div class="overlay container max-w-screen-sm w-full hidden sm:hidden fixed top-0 right-0 h-screen bg-black bg-opacity-40 z-30">
        <nav class="nav-mobile hidden fixed top-0 right-0 flex flex-col justify-between items-center pt-14 px-12 pb-5 bg-white w-9/12 h-3/4 z-40">
          <ul class="nav__list flex flex-col flex-1 justify-between items-center container box-content w-32 h-auto max-h-nav text-xs font-normal">
             <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#work">Work</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#about">About</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/#join">Join Vac</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/research-log">Research log</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a class="nav__link" href="/media">Media</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a href="https://rfc.vac.dev/" target="_blank" rel="noopener noreferrer">Specs</a>
  
</li>
  <li class="hover:opacity-50">
  
  <a href="https://forum.vac.dev/" target="_blank" rel="noopener noreferrer">Forum</a>
  
</li>
 
          </ul>
          <ul class="social items-center flex mt-8">
            <li class="pr-5">
  <a href="https://twitter.com/vacp2p" target="_blank" rel="noopener noreferrer">
    <svg width="25" height="21" viewBox="0 0 25 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M24.8872 3.04499C23.9872 3.43499 23.0572 3.70498 22.0672 3.82499C23.0872 3.22498 23.8672 2.26499 24.2272 1.09499C23.2672 1.66499 22.2172 2.05499 21.1072 2.29499C20.2072 1.33499 18.9172 0.734985 17.5072 0.734985C14.7772 0.734985 12.5872 2.95499 12.5872 5.65499C12.5872 6.04499 12.6172 6.40498 12.7072 6.76498C8.62721 6.58498 5.02721 4.60498 2.59721 1.63499C0.857207 4.75498 2.80721 7.33499 4.09721 8.20499C3.31721 8.20499 2.53721 7.96499 1.87721 7.60499C1.87721 10.035 3.58721 12.045 5.80721 12.495C5.32721 12.645 4.24721 12.735 3.58721 12.585C4.21721 14.535 6.04721 15.975 8.17721 16.005C6.49721 17.325 4.03721 18.375 0.887207 18.045C3.07721 19.455 5.65721 20.265 8.44721 20.265C17.5072 20.265 22.4272 12.765 22.4272 6.28499C22.4272 6.07499 22.4272 5.86499 22.3972 5.65499C23.4172 4.90499 24.2572 4.03499 24.8872 3.04499Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>
<li class="pr-5">
  <a href="https://github.com/vacp2p" target="_blank" rel="noopener noreferrer">
    <svg width="26" height="25" viewBox="0 0 26 25" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M12.8857 0.856567C6.26021 0.856567 0.915339 6.20154 0.950043 12.7951C0.9778 18.0687 4.43935 22.5427 9.21766 24.1227C9.81824 24.2327 10.0353 23.864 10.0336 23.5474C10.0321 23.2635 10.0177 22.5129 10.0065 21.5171C6.67274 22.238 5.95552 19.9163 5.95552 19.9163C5.40376 18.5369 4.61433 18.1698 4.61433 18.1698C3.51994 17.4296 4.69151 17.4444 4.69151 17.4444C5.89646 17.5291 6.53549 18.6751 6.53549 18.6751C7.61609 20.4989 9.35182 19.9727 10.0342 19.6665C10.1382 18.8951 10.4459 18.3689 10.7878 18.0702C8.12222 17.7684 5.31483 16.7443 5.29076 12.1708C5.2839 10.8672 5.74629 9.80152 6.50989 8.96619C6.3838 8.66445 5.96641 7.45009 6.61027 5.80766C6.61027 5.80766 7.61658 5.4866 9.9167 7.03094C10.8723 6.76636 11.8976 6.63408 12.9191 6.62962C13.9376 6.63556 14.9658 6.76636 15.9257 7.03242C18.2081 5.48809 19.2163 5.80914 19.2163 5.80914C19.8789 7.45306 19.4743 8.66594 19.3529 8.96767C20.1268 9.80301 20.5959 10.8687 20.6028 12.1723C20.6269 16.7577 17.8272 17.767 15.1558 18.0628C15.5882 18.4314 15.976 19.1597 15.9819 20.273C15.9903 21.8693 15.9821 23.1565 15.9841 23.5474C15.9858 23.867 16.2038 24.2386 16.8122 24.1212C21.5663 22.5397 24.9778 18.0672 24.95 12.7951C24.9153 6.20154 19.5142 0.856567 12.8857 0.856567Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>
<li>
  <a href="https://discord.gg/PQFdubGt6d" target="_blank" rel="noopener noreferrer">
    <svg width="25" height="21" viewBox="0 0 25 21" fill="none" xmlns="http://www.w3.org/2000/svg" class="hover:opacity-50">
      <path
        d="M22.7861 9.04256C21.8482 5.74455 20.7799 4.04048 20.7627 4.00991C20.7017 3.93459 19.189 2.104 15.5271 0.75L15.0353 2.0764C16.7774 2.72057 18.0116 3.50643 18.6899 4.01419C16.6599 3.40408 14.2431 3.03041 12.1008 3.03041C9.95851 3.03041 7.53775 3.40408 5.50128 4.01419C6.18496 3.50648 7.42744 2.72057 9.17631 2.0764L8.69846 0.75C5.02238 2.104 3.49044 3.93459 3.42863 4.00991C3.41108 4.04048 2.32479 5.74455 1.35221 9.04256C0.414855 12.2208 0.0415214 16.7045 0.027872 16.8843C0.109225 17.0131 1.97891 20.25 7.12077 20.25L8.43406 18.3536C6.97595 17.964 5.58693 17.3357 4.31689 16.4832L5.10228 15.3069C7.15122 16.6822 9.54509 17.4092 12.0251 17.4092C14.5051 17.4092 16.9067 16.6822 18.9701 15.3069L19.7431 16.4832C18.4641 17.3357 17.0684 17.964 15.6062 18.3536L16.8995 20.25C22.0414 20.25 23.9452 17.0131 24.0279 16.8843C24.0161 16.7045 23.69 12.2208 22.7861 9.04256ZM8.79853 12.7392H7.39228L7.40468 10.3841H8.81093L8.79853 12.7392ZM16.7071 12.7392H15.3008L15.3132 10.3841H16.7195L16.7071 12.7392Z"
        fill="#151512"
      />
    </svg>
  </a>
</li>

          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>


      <main class="bg-white text-black flex flex-col"><section class="container max-w-screen-xl flex flex-col items-center pt-10 pb-0 md:pb-10 lg:pb-0">
  <div class="info-block max-w-680 pb-5 sm:pb-10 overflow-hidden">
    <div class="post mb-10">
      <h1 class="text-xl md:text-xxl mb-5 sm:max-w-md lg:max-w-2xl">Introducing nwaku</h1>
      <div>
        <span class="text-s lg:text-base"> 12 Apr 2022 • by </span>
        <a href="/authors/hanno" class="text-s lg:text-base font-bold hover:underline">hanno</a>
      </div>
    </div>
    <div class="post__content"><h2 id="background">Background</h2>

<p>If you’ve been following our <a href="https://vac.dev/research-log/">research log</a>,
you’ll know that many things have happened in the world of Waku v2 since <a href="/waku-v2-ethereum-coscup">our last general update</a>.
In line with our <a href="https://vac.dev/#about">long term goals</a>,
we’ve introduced new protocols,
tweaked our existing protocols
and expanded our team.
We’ve also shown <a href="/waku-v1-v2-bandwidth-comparison">in a series of practical experiments</a> that Waku v2 does indeed deliver on some of the <a href="/waku-v2-plan">theoretical advantages</a> it was designed to have over its predecessor, Waku v1.
A <a href="https://forum.vac.dev/t/vac-sustainability-and-business-workshop/116">sustainability and business workshop</a> led to the formulation of a clearer vision for Vac as a team.</p>

<p>From the beginning, our protocol development has been complemented by various client implementations of these protocols,
first in <a href="https://github.com/status-im/nim-waku">Nim</a>,
but later also in <a href="https://github.com/status-im/js-waku">JavaScript</a>
and <a href="https://github.com/status-im/go-waku">Go</a>.
A follow-up post will clarify the purposes, similarities and differences between these three clients.
The <a href="https://github.com/status-im/nim-waku/tree/d2fccb5220144893f994a67f2cc26661247f101f/waku/v2">Nim client</a>, is our reference implementation,
developed by the research team in parallel with the specs
and building on a home-grown implementation of <a href="https://github.com/status-im/nim-libp2p"><code class="highlighter-rouge">libp2p</code></a>.
The Nim client is suitable to run as <a href="/waku-update">a standalone adaptive node</a>,
managed by individual operators
or as an encapsulated service node in other applications.
This post looks at some recent developments within the Nim client.</p>

<h2 id="1-nim-waku-is-now-known-as-nwaku">1. <em><strong>nim-waku</strong></em> is now known as <em><strong>nwaku</strong></em></h2>

<p>Pronounced NWHA-koo.
You may already have seen us refer to “<code class="highlighter-rouge">nwaku</code>” on Vac communication channels,
but it is now official:
The <code class="highlighter-rouge">nim-waku</code> Waku v2 client has been named <code class="highlighter-rouge">nwaku</code>.
Why? Well, we needed a recognizable name for our client that could easily be referred to in everyday conversations
and <code class="highlighter-rouge">nim-waku</code> just didn’t roll off the tongue.
We’ve followed the example of the closely related <a href="https://github.com/status-im/nimbus-eth2"><code class="highlighter-rouge">nimbus</code> project</a> to find a punchier name
that explicitly links the client to both the Waku set of protocols and the Nim language.</p>

<h2 id="2-improvements-in-stability-and-performance">2. Improvements in stability and performance</h2>

<p>The initial implementation of Waku v2 demonstrated how the suite of protocols can be applied
to form a generalized, peer-to-peer messaging network,
while addressing a wide range of adaptive requirements.
This allowed us to lift several protocol <a href="https://rfc.vac.dev/">specifications</a> from <code class="highlighter-rouge">raw</code> to <code class="highlighter-rouge">draft</code> status,
indicating that a reference implementation exists for each.
However, as internal dogfooding increased and more external applications started using <code class="highlighter-rouge">nwaku</code>,
we stepped up our focus on the client’s stability and performance.
This is especially true where we want <code class="highlighter-rouge">nwaku</code> to run unsupervised in a production environment
without any degradation in the services it provides.</p>

<p>Some of the more significant productionization efforts over the last couple of months included:</p>

<ol>
  <li>
    <p>Reworking the <code class="highlighter-rouge">store</code> implementation to maintain stable memory usage
while storing historical messages
and serving multiple clients querying history simultaneously.
Previously, a <code class="highlighter-rouge">store</code> node would see gradual service degradation
due to inefficient memory usage when responding to history queries.
Queries that often took longer than 8 mins now complete in under 100 ms.</p>
  </li>
  <li>
    <p>Improved peer management.
For example, <code class="highlighter-rouge">filter</code> nodes will now remove unreachable clients after a number of connection failures,
whereas they would previously keep accumulating dead peers.</p>
  </li>
  <li>
    <p>Improved disk usage.
<code class="highlighter-rouge">nwaku</code> nodes that persist historical messages on disk now manage their own storage size based on the <code class="highlighter-rouge">--store-capacity</code>.
This can significantly improve node start-up times.</p>
  </li>
</ol>

<p>More stability issues may be addressed in future as <code class="highlighter-rouge">nwaku</code> matures,
but we’ve noticed a marked improvement in the reliability of running <code class="highlighter-rouge">nwaku</code> nodes.
These include environments where <code class="highlighter-rouge">nwaku</code> nodes are expected to run with a long uptime.
Vac currently operates two long-running fleets of <code class="highlighter-rouge">nwaku</code> nodes, <code class="highlighter-rouge">wakuv2.prod</code> and <code class="highlighter-rouge">wakuv2.test</code>,
for internal dogfooding and
to serve as experimental bootstrapping nodes.
Status has also recently deployed similar fleets for production and testing based on <code class="highlighter-rouge">nwaku</code>.
Our goal is to have <code class="highlighter-rouge">nwaku</code> be stable, performant and flexible enough
to be an attractive option for operators to run and maintain their own Waku v2 nodes.
See also the <a href="#future-work">future work</a> section below for more on our general goal of <em><code class="highlighter-rouge">nwaku</code> for operators</em>.</p>

<h2 id="3-improvements-in-interoperability">3. Improvements in interoperability</h2>

<p>We’ve implemented several features that improve <code class="highlighter-rouge">nwaku</code>’s usability in different environments
and its interoperability with other Waku v2 clients.
One major step forward here was adding support for both secure and unsecured WebSocket connections as <code class="highlighter-rouge">libp2p</code> transports.
This allows direct connectivity with <code class="highlighter-rouge">js-waku</code>
and paves the way for native browser usage.
We’ve also added support for parsing and resolving DNS-type <code class="highlighter-rouge">multiaddrs</code>,
i.e. multiaddress protocol schemes <a href="https://github.com/multiformats/multiaddr/blob/b746a7d014e825221cc3aea6e57a92d78419990f/protocols.csv#L8-L11"><code class="highlighter-rouge">dns</code>, <code class="highlighter-rouge">dns4</code>, <code class="highlighter-rouge">dns6</code> and <code class="highlighter-rouge">dnsaddr</code></a>.
A <code class="highlighter-rouge">nwaku</code> node can now also be <a href="https://github.com/status-im/nim-waku/tree/d2fccb5220144893f994a67f2cc26661247f101f/waku/v2#configuring-a-domain-name">configured with its own IPv4 DNS domain name</a> 
allowing dynamic IP address allocation without impacting a node’s reachability by its peers.</p>

<h2 id="4-peer-discovery">4. Peer discovery</h2>

<p><em>Peer discovery</em> is the method by which nodes become aware of each other’s existence.
The question of peer discovery in a Waku v2 network has been a focus area since the protocol was first conceptualized.
Since then several different approaches to discovery have been proposed and investigated.
We’ve implemented three discovery mechanisms in <code class="highlighter-rouge">nwaku</code> so far:</p>

<h3 id="dns-based-discovery">DNS-based discovery</h3>

<p><code class="highlighter-rouge">nwaku</code> nodes can retrieve an authenticated, updateable list of peers via DNS to bootstrap connection to a Waku v2 network.
Our implementation is based on <a href="https://eips.ethereum.org/EIPS/eip-1459">EIP-1459</a>.</p>

<h3 id="gossipsub-peer-exchange">GossipSub peer exchange</h3>

<p><a href="https://github.com/libp2p/specs/blob/10712c55ab309086a52eec7d25f294df4fa96528/pubsub/gossipsub/gossipsub-v1.1.md#prune-backoff-and-peer-exchange">GossipSub Peer Exchange (PX)</a> is a GossipSub v1.1 mechanism
whereby a pruning peer may provide a pruned peer with a set of alternative peers
where it can connect to reform its mesh.
This is a very suitable mechanism to gradually discover more peers
from an initial connection to a small set of bootstrap peers.
It is enabled in a <code class="highlighter-rouge">nwaku</code> node by default.</p>

<h3 id="waku-node-discovery-protocol-v5">Waku Node Discovery Protocol v5</h3>

<p>This is a DHT-based discovery mechanism adapted to store and relay <em>node records</em>.
Our implementation is based on <a href="https://github.com/ethereum/devp2p/blob/fa6428ada7385c13551873b2ae6ad2457c228eb8/discv5/discv5-theory.md">Ethereum’s Discovery v5 protocol</a>
with some <a href="https://rfc.vac.dev/spec/33/">minor modifications</a> to isolate our discovery network from that of Ethereum.
The decision to separate the Waku Discovery v5 network from Ethereum’s was made on considerations of lookup efficiency.
This comes at a possible tradeoff in network resilience.
We are considering merging with the Ethereum Discovery v5 network in future,
or even implement a hybrid solution.
<a href="https://forum.vac.dev/t/waku-v2-discv5-roadmap-discussion/121/8">This post</a> explains the decision and future steps.</p>

<h2 id="5-spam-protection-using-rln">5. Spam protection using RLN</h2>

<p>An early addition to our suite of protocols was <a href="https://rfc.vac.dev/spec/32/">an extension of <code class="highlighter-rouge">11/WAKU-RELAY</code></a>
that provided spam protection using <a href="https://rfc.vac.dev/spec/32/">Rate Limiting Nullifiers (RLN)</a>.
The <code class="highlighter-rouge">nwaku</code> client now contains a working demonstration and integration of RLN relay.
Check out <a href="https://github.com/status-im/nim-waku/blob/ee96705c7fbe4063b780ac43b7edee2f6c4e351b/docs/tutorial/rln-chat2-live-testnet.md">this tutorial</a> to see the protocol in action using a toy chat application built on <code class="highlighter-rouge">nwaku</code>.
We’d love for people to join us in dogfooding RLN spam protection as part of our operator incentive testnet.
Feel free to join our <a href="https://discord.gg/KNj3ctuZvZ">Vac Discord</a> server
and head to the <code class="highlighter-rouge">#rln</code> channel for more information.</p>

<h2 id="future-work">Future work</h2>

<p>As we continue working towards our goal of a fully decentralized, generalized and censorship-resistant messaging protocol,
these are some of the current and future focus areas for <code class="highlighter-rouge">nwaku</code>:</p>

<h3 id="reaching-out-to-operators">Reaching out to operators:</h3>

<p>We are starting to push for operators to run and maintain their own Waku v2 nodes,
preferably contributing to the default Waku v2 network as described by the default pubsub topic (<code class="highlighter-rouge">/waku/2/default-waku/proto</code>).
Amongst other things, a large fleet of stable operator-run Waku v2 nodes will help secure the network,
provide valuable services to a variety of applications
and ensure the future sustainability of both Vac as a research organization and the Waku suite of protocols.</p>

<p>We are targeting <code class="highlighter-rouge">nwaku</code> as the main option for operator-run nodes.<br />
Specifically, we aim to provide through <code class="highlighter-rouge">nwaku</code>:</p>

<ol>
  <li>a lightweight and robust Waku v2 client.
This client must be first in line to support innovative and new Waku v2 protocols,
but configurable enough to serve the adaptive needs of various operators.</li>
  <li>an easy-to-follow guide for operators to configure,
set up and maintain their own nodes</li>
  <li>a set of operator-focused tools to monitor and maintain a running node</li>
</ol>

<h3 id="better-conversational-security-layer-guarantees">Better conversational security layer guarantees</h3>

<p>Conversational security guarantees in Waku v2 are currently designed around the Status application.
Developers building their own applications on top of Waku would therefore
either have to reimplement a set of tools similar to Status
or build their own security solutions on the application layer above Waku.
We are working on <a href="https://github.com/vacp2p/research/issues/97">a set of features</a> built into Waku
that will provide the general security properties Waku users may desire
and do so in a modern and simple way.
This is useful for applications outside of Status that want similar security guarantees.
As a first step, we’ve already made good progress toward <a href="https://forum.vac.dev/t/noise-handshakes-as-key-exchange-mechanism-for-waku2/130">integrating noise handshakes</a> as a key exchange mechanism in Waku v2.</p>

<h3 id="protocol-incentivization">Protocol incentivization</h3>

<p>We want to design incentivization around our protocols to encourage desired behaviors in the Waku network,
rewarding nodes providing costly services
and punishing adversarial actions.
This will increase the overall security of the network
and encourage operators to run their own Waku nodes.
In turn, the sustainability of Vac as an organization will be better guaranteed.
As such, protocol incentivization was a major focus in our recent <a href="https://forum.vac.dev/t/vac-sustainability-and-business-workshop/">Vac Sustainability and Business Workshop</a>.
Our first step here is to finish integrating RLN relay into Waku
with blockchain interaction to manage members,
punish spammers
and reward spam detectors.
After this, we want to design monetary incentivization for providers of <code class="highlighter-rouge">store</code>, <code class="highlighter-rouge">lightpush</code> and <code class="highlighter-rouge">filter</code> services.
This may also tie into a reputation mechanism for service nodes based on a network-wide consensus on service quality.
A big challenge for protocol incentivization is doing it in a private fashion,
so we can keep similar metadata protection guarantees as the Waku base layer.
This ties into our focus on <a href="https://forum.vac.dev/t/vac-3-zk/97">Zero Knowledge tech</a>.</p>

<h3 id="improved-store-capacity">Improved store capacity</h3>

<p>The <code class="highlighter-rouge">nwaku</code> store currently serves as an efficient in-memory store for historical messages,
dimensioned by the maximum number of messages the store node is willing to keep.
This makes the <code class="highlighter-rouge">nwaku</code> store appropriate for keeping history over a short term
without any time-based guarantees,
but with the advantage of providing fast responses to history queries.
Some applications, such as Status, require longer-term historical message storage
with time-based dimensioning
to guarantee that messages will be stored for a specified minimum period.
Because of the relatively high cost of memory compared to disk space,
a higher capacity store, with time guarantees, should operate as a disk-only database of historical messages.
This is an ongoing effort.</p>

<h3 id="multipurpose-discovery">Multipurpose discovery</h3>

<p>In addition to <a href="#4-peer-discovery">the three discovery methods</a> already implemented in <code class="highlighter-rouge">nwaku</code>,
we are working on improving discovery on at least three fronts:</p>

<h4 id="capability-discovery"><em>Capability discovery:</em></h4>

<p>Waku v2 nodes may be interested in peers with specific capabilities, for example:</p>

<ol>
  <li>peers within a specific pubsub topic mesh,</li>
  <li>peers with <strong>store</strong> capability,</li>
  <li><strong>store</strong> peers with x days of history for a specific content topic, etc.</li>
</ol>

<p>Capability discovery entails mechanisms by which such capabilities can be advertised and discovered/negotiated.
One major hurdle to overcome is the increased complexity of finding a node with specific capabilities within the larger network (a needle in a haystack).
See the <a href="https://github.com/vacp2p/rfc/issues/429">original problem statement</a> for more.</p>

<h4 id="improvements-in-discovery-v5"><em>Improvements in Discovery v5</em></h4>

<p>Of the implemented discovery methods,
Discovery v5 best addresses our need for a decentralized and scalable discovery mechanism.
With the basic implementation done,
there are some improvements planned for Discovery v5,
including methods to increase security such as merging with the Ethereum Discovery v5 network,
introducing explicit NAT traversal
and utilizing <a href="https://github.com/ethereum/devp2p/blob/fa6428ada7385c13551873b2ae6ad2457c228eb8/discv5/discv5-theory.md#topic-advertisement">topic advertisement</a>.
The <a href="https://forum.vac.dev/t/waku-v2-discv5-roadmap-discussion/121">Waku v2 Discovery v5 Roadmap</a> contains more details.</p>

<h4 id="generalized-peer-exchange"><em>Generalized peer exchange</em></h4>

<p><code class="highlighter-rouge">nwaku</code> already implements <a href="https://github.com/libp2p/specs/blob/10712c55ab309086a52eec7d25f294df4fa96528/pubsub/gossipsub/gossipsub-v1.1.md#prune-backoff-and-peer-exchange">GossipSub peer exchange</a>.
We now need a general request-response mechanism outside of GossipSub
by which a node may learn about other Waku v2 nodes
by requesting and receiving a list of peers from a neighbor.
This could, for example, be a suitable way for resource-restricted devices to request a stronger peer
to perform a random Discovery v5 lookup on their behalf
or simply to be informed of a subset of the peers known to that neighbor.
See <a href="https://github.com/vacp2p/rfc/issues/495">this issue</a> for more.</p>

<hr />

<p>This concludes a general outline of some of the main recent developments in the <code class="highlighter-rouge">nwaku</code> client
and a summary of the current and future focus areas.
Much more is happening behind the scenes, of course,
so for more information, or to join the conversation,
feel free to join our <a href="https://discord.gg/KNj3ctuZvZ">Vac Discord</a> server
or to check out the <a href="https://github.com/status-im/nim-waku"><code class="highlighter-rouge">nwaku</code> repo on Github</a>.
You can also view the changelog for past releases <a href="https://github.com/status-im/nim-waku/releases">here</a>.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://rfc.vac.dev/spec/17/">17/WAKU-RLN-RELAY</a></li>
  <li><a href="https://rfc.vac.dev/spec/32/">32/RLN</a></li>
  <li><a href="https://rfc.vac.dev/spec/33/">33/WAKU2-DISCV5</a></li>
  <li><a href="https://github.com/vacp2p/rfc/issues/429">Capabilities advertising</a></li>
  <li><a href="https://github.com/status-im/nim-waku/tree/d2fccb5220144893f994a67f2cc26661247f101f/waku/v2#configuring-a-domain-name">Configuring a domain name</a></li>
  <li><a href="https://github.com/vacp2p/research/issues/97">Conversational security</a></li>
  <li><a href="https://github.com/ethereum/devp2p/blob/fa6428ada7385c13551873b2ae6ad2457c228eb8/discv5/discv5-theory.md#topic-advertisement">Discovery v5 Topic Advertisement</a></li>
  <li><a href="https://eips.ethereum.org/EIPS/eip-1459">EIP-1459</a></li>
  <li><a href="https://github.com/libp2p/specs/blob/10712c55ab309086a52eec7d25f294df4fa96528/pubsub/gossipsub/gossipsub-v1.1.md#prune-backoff-and-peer-exchange">GossipSub Peer Exchange</a></li>
  <li><a href="https://github.com/status-im/go-waku">go-waku</a></li>
  <li><a href="https://github.com/status-im/js-waku">js-waku</a></li>
  <li><a href="https://github.com/multiformats/multiaddr/blob/b746a7d014e825221cc3aea6e57a92d78419990f/protocols.csv#L8-L11"><code class="highlighter-rouge">multiaddr</code> formats</a></li>
  <li><a href="https://github.com/status-im/nimbus-eth2">nimbus-eth2</a></li>
  <li><a href="https://github.com/status-im/nim-libp2p">nim-libp2p</a></li>
  <li><a href="https://github.com/status-im/nim-waku">nim-waku</a></li>
  <li><a href="https://github.com/status-im/nim-waku/releases">nim-waku releases</a></li>
  <li><a href="https://github.com/ethereum/devp2p/blob/fa6428ada7385c13551873b2ae6ad2457c228eb8/discv5/discv5-theory.md">Node Discovery Protocol v5 - Theory</a></li>
  <li><a href="https://forum.vac.dev/t/noise-handshakes-as-key-exchange-mechanism-for-waku2/130">Noise handshakes</a></li>
  <li><a href="https://github.com/status-im/nim-waku/blob/ee96705c7fbe4063b780ac43b7edee2f6c4e351b/docs/tutorial/rln-chat2-live-testnet.md">RLN tutorial</a></li>
  <li><a href="https://forum.vac.dev/t/vac-3-zk/97">Vac &lt;3 ZK</a></li>
  <li><a href="https://vac.dev/#about">Vac About page</a></li>
  <li><a href="https://vac.dev/research-log/">Vac Research log</a></li>
  <li><a href="https://rfc.vac.dev/">Vac RFC site</a></li>
  <li><a href="https://forum.vac.dev/t/vac-sustainability-and-business-workshop/">Vac Sustainability and Business Workshop</a></li>
  <li><a href="/waku-update">Waku Update</a></li>
  <li><a href="/waku-v1-v2-bandwidth-comparison">Waku v1 vs Waku v2: Bandwidth Comparison</a></li>
  <li><a href="https://github.com/vacp2p/rfc/issues/495">Waku v2 Peer Exchange</a></li>
  <li><a href="https://forum.vac.dev/t/waku-v2-discv5-roadmap-discussion/121">Waku v2 Discovery v5 Roadmap</a></li>
  <li><a href="/waku-v2-plan">What’s the Plan for Waku v2?</a></li>
</ul>
</div>
  </div>
</section>
</main>
    </div>
    <footer class="footer bg-black flex flex-shrink-0 justify-center">
  <div class="container max-w-screen-xl flex sl:justify-between lm:justify-start p-5 md:px-12 md:pt-5 lg:py-10">
    <div class="logo mr-10 sm:mr-0 sm:w-2/12 lg:w-3/12">
      <a href="/"><img src="/assets/img/logo.png" alt="Vac logo" class="w-9 h-11" /></a>
    </div>

    <div class="flex flex-col xm:flex-row xm:justify-between sm:w-10/12 lg:w-9/12">
      <p class="hidden sl:inline-block sl:mr-10 text-xxs lg:text-base text-white opacity-75">Vac researches peer-to-peer, private, censorship resistant communication</p>
      <nav class="flex max-w-xs mr-0 xm:mr-5 l:mr-32 mb-5 sm:mb-0">
        <div class="flex">
          <div class="flex flex-col mr-5 sm:mr-10 sl:mr-14">
            <p class="text-xxs lg:text-base text-white opacity-75 mb-5 lg:mb-8">Research</p>
            <ul>
               <li class="text-xxs lg:text-base text-white hover:opacity-50 mb-5">
  <a href="/research-log" target="_blank" rel="noopener noreferrer">Log</a>
</li>
  <li class="text-xxs lg:text-base text-white hover:opacity-50 mb-5">
  <a href="https://rfc.vac.dev/" target="_blank" rel="noopener noreferrer">Specs</a>
</li>
 
            </ul>
          </div>
          <div class="flex flex-col sl:mr-14">
            <p class="text-xxs lg:text-base text-white opacity-75 mb-5 lg:mb-8">Socials</p>
            <ul>
               <li class="text-xxs lg:text-base text-white hover:opacity-50 mb-5">
  <a href="https://twitter.com/vacp2p" target="_blank" rel="noopener noreferrer">Twitter</a>
</li>
  <li class="text-xxs lg:text-base text-white hover:opacity-50 mb-5">
  <a href="https://discord.gg/PQFdubGt6d" target="_blank" rel="noopener noreferrer">Discord</a>
</li>
  <li class="text-xxs lg:text-base text-white hover:opacity-50 mb-5">
  <a href="https://t.me/vacp2p" target="_blank" rel="noopener noreferrer">Telegram</a>
</li>
 
            </ul>
          </div>
        </div></nav></div>
  </div>
</footer>
 <script src="/assets/js/main.min.js"></script>
<script src="/assets/js/smooth-scroll.min.js"></script>

  </body>
</html>
